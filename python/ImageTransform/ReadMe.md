## 图像变换


### 频域变换

在数字图像处理中，有两个经典变换被广泛应用：傅里叶变换和霍夫变换。其中傅里叶变换主要是将时间域上的信号转变为频率域上的信号，用来进行图像降噪，图像增强等处理。

傅里叶变换可以参考知乎的高赞文章：[傅里叶变换](https://zhuanlan.zhihu.com/p/19763358)。对于数字图像这种离散信号，频率大小表示信号变换的剧烈程度或是信号变化的快慢。频率越大，变换越剧烈，频率越小，信号越平缓，对应到图像中，高频信号往往是图像中的边缘信号和噪声信号，而低频信号包含图像变化频繁的图像轮廓以及背景等信号。

- 高频：变换剧烈的灰度分量，例如边界
- 低频：变换缓慢的灰度分量，例如一片大海

**滤波器：**
- 低通滤波器：只保留低频，会使得图像模糊
- 高频滤波器：只保留高频，会使得图像细节增强

![image](https://user-images.githubusercontent.com/27406337/163906213-5cf3dc85-7dee-44fc-9ccc-2c77f2907cf6.png)

**频域数据的应用：**

1. 图像去噪：根据需要获得在频域对图像进行处理，比如在需要除去图像中的噪声时，我们可以设计一个低通滤波器，去掉图像中的高频噪声，但是往往也会抑制图像的边缘信息，这就是造成图像模糊的原因。以均值滤波为例，用均值模板与图像做卷积，大家都知道，在空间域做卷积，相当于在频域做乘积，而均值模板在频域是没有高频信号的，只有一个常量的分量，所以均值模板是对图像局部做低通滤波。除此之外，常见的高斯滤波也是一种低通滤波器，因为高斯函数经过傅里叶变换后，在频域的分布依然服从高斯分布，如下图所示，所以它对高频信息有很好的滤除效果。

![image](https://user-images.githubusercontent.com/27406337/163906346-190408a5-d7c0-4043-bf23-9956c77b6a28.png)

2. 图像增强以及锐化：图像增强需要增强图像的细节，而图像的细节往往就是图像中高频的部分，所以增强图像中的高频信息能够达到图像增强的目的。同样的图像锐化的目的是使模糊的图像变得更加清晰，其主要方式是增强图像的边缘部分，其实就是增强图像中灰度变化剧烈的部分，所以通过增强图像中的高频信息能够增强图像边缘，从而达到图像锐化的目的。从这里可以看出，可以通过提取图像中的高频信号来得到图像的边缘和纹理信息。


**图像傅里叶变换的物理意义**

图像的频率是表征图像中灰度变换剧烈程度的指标，是灰度在平面空间上的梯度。如：大面积的沙漠在图像中是一片灰度变化缓慢的区域，对应的频率值很低；而对于地表属性变换剧烈的边缘区域在图像中是一片灰度变化剧烈的区域，对应的频率值较高。傅里叶变换在实际中有明显的物理意义，设f 是一个能量有限的模拟信号，则其傅里叶变换就表示 f 的频谱。从纯粹的数学意义上看，傅里叶变换是将一个函数转换为一系列周期函数来处理的。从物理效果来看，傅里叶变换是将图像从空间域转换到频率域，其逆变换是将图像从频率域转换到空间域。换句话说，傅里叶变换的物理意义是将图像的灰度分布函数变换为图像的频率分布函数。

　　傅里叶逆变换是将图像的频率分布函数变换为灰度分布函数傅里叶变换以前，图像（未压缩的位图）是由对在连续空间（现实空间）上的采样得到一系列的集合，通常用一个二维矩阵表示空间上各点，记为 z=f(x, y)。又因为空间是三维的，图像是二维的，因此空间中物体在另一个维度上的关系就必须由梯度来表示，这样我们才能通过观察图像得知物体在三维空间中的对应关系。

　　傅里叶频谱图上我们看到的明暗不一的亮点，其意义是指图像上某一点与领域点差异的强弱，即梯度的大小。也即该点的频率的大小（可以这么理解，图像中低频部分指低梯度的点，高频部分相反）。一般来说，梯度大则该点的亮度强，否则该点的亮度弱。这样通过观察傅里叶变换后的频谱图，也叫功率图，我们就可以直观的看出图像的能量分布：如果频谱图中暗的点数更多，那么实际图像是比较柔和的（因为各点与领域差异都不大，梯度相对较小）；反之，如果频谱图中亮的点数多，那么实际图像一定是尖锐的，边界分明且边界两边像素差异较大的。

　　对频谱移频到原点以后，可以看出图像的频率分布是以原点为圆心，对称分布的。将频谱移频到圆心除了可以清晰的看出图像频率分布以外，还有一个好处，它可以分离出周期性规律的干扰信号，比如正弦干扰。一幅频谱图如果带有正弦干扰，移频到原点上就可以看出，除了中心以外还存在以另一点为中心，对称分布的亮点集合，这个集合就是干扰噪音产生的。这时可以很直观的通过在该位置放置带阻滤波器消除干扰。
  
**OpenCV实现傅里叶变换**
 
 OpenCV中实现傅里叶变换的函数是 cv2.dft()，他和Numpy输出的结果是一样的，但是是双通道的。第一个通道是结果的实数部分，第二个通道是结果的虚数部分，并且输入图像要首先转换成  np.float32格式。其函数原型如下：
```python
dst = cv2.dft(src, dst=None, flags=None, nonzeroRows=None)
```
参数含义：
  - src表示输入图像，需要通过np.float32转换格式
  - dst表示输出图像，包括输出大小和尺寸flags表示转换标记，其中：

    1. DFT_INVERSE执行反向一维或二维转换，而不是默认的正向转换；

    2. DFT_SCALE表示缩放结果，由阵列元素的数量除以它；
     
    3. DFT_ROWS执行正向或反向变换输入矩阵的每个单独的行，该标志可以同时转换多个矢量，并可用于减少开销以执行3D和更高维度的转换等；

    4. DFT_COMPLEX_OUTPUT执行1D或2D实数组的正向转换，这是最快的选择，默认功能；

    5. DFT_REAL_OUTPUT执行一维或二维复数阵列的逆变换，结果通常是相同大小的复数数组，但如果输入数组具有共轭复数对称性，则输出为真实数组

  - nonzeroRows表示当参数不为零时，函数假定只有nonzeroRows输入数组的第一行（未设置）或者只有输出数组的第一个（设置）包含非零，因此函数可以处理其余的行更有效率，并节省一些时间；这种技术对计算阵列互相关或使用DFT卷积非常有用

**注意**：由于输出的频谱结果是一个复数，需要调用 cv2.magnitude() 函数将傅里叶变换的双通达结果转换为0到255的范围。其函数原型如下：

```python
cv2.magnitude(x, y, magnitude=None)
```
 

### 空间域变换


空间域变换主要涉及到图像的插值、图像旋转，镜像旋转等，在此不做详细说明了。